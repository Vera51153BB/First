<!doctype html>
<html lang="ru">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>OKX SWAP Chart</title>

	<!-- –§–∞–∫—Ç: CSP —Ä–∞–∑—Ä–µ—à–∞–µ—Ç Telegram WebApp, OKX REST/WS, Lightweight-Charts, TradingView (–¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞) -->
	<meta http-equiv="Content-Security-Policy"
		content="default-src 'self' https://telegram.org https://s3.tradingview.com https://*.tradingview.com https://unpkg.com;
		         img-src 'self' data: https:;
		         style-src 'self' 'unsafe-inline';
		         script-src 'self' https://telegram.org https://s3.tradingview.com https://unpkg.com 'unsafe-inline';
		         connect-src 'self' https://www.okx.com wss://ws.okx.com wss://wsaws.okx.com;">

	<style>
		:root{
			--bg:#0b0f14; --text:#e6e6e6; --muted:#9aa4af; --accent:#ffd65c; --danger:#ff6b6b;
			--pad: clamp(10px, 2.5vw, 14px);
			--radius: 12px;

			/* –í—ã—Å–æ—Ç–∞ —É–∑–∫–æ–π –¥–æ–∫-–ø–∞–Ω–µ–ª–∏ —Å–Ω–∏–∑—É (1 —Å—Ç—Ä–æ–∫–∞) */
			--dock-h: clamp(42px, 8vw, 56px);

			/* –í—ã—Å–æ—Ç–∞ –≤—ã–µ–∑–∂–∞—é—â–µ–π –ø–∞–Ω–µ–ª–∏ (–ø–∞–Ω–µ–ª—å –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫) */
			--panel-h: min(60vh, 420px);
		}
		html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Arial}
		#wrap{height:100%;display:flex;flex-direction:column}
		header{padding:10px 14px;font-weight:600;letter-spacing:.3px}
		#chart{flex:1;min-height:320px}

		/* 1. –£–∑–∫–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–Ω–∏–∑—É: –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä + —Å—Ç—Ä–µ–ª–∫–∞ */
		footer#dock{
			position: relative;
			height: var(--dock-h);
			min-height: var(--dock-h);
			max-height: var(--dock-h);
			border-top: 1px solid rgba(255,255,255,.08);
			padding: 0 var(--pad);
			display:flex; align-items:center; gap:10px;
			background: rgba(255,255,255,0.02);
		}
		#status-dot{
			width: 10px; height: 10px; border-radius: 50%;
			box-shadow: 0 0 0 2px rgba(255,255,255,.06) inset;
		}
		#status-dot.online{ background:#34c759; }     /* üü¢ */
		#status-dot.degraded{ background:#ffd60a; }   /* üü° */
		#status-dot.offline{ background:#ff453a; }    /* üî¥ */
		#status-text{ color: var(--muted); font-size: 14px }
		.spacer{flex:1}
		#btn-panel{
			background: transparent; color: var(--text);
			border: 1px solid rgba(255,255,255,.18);
			border-radius: var(--radius);
			padding: 8px 12px; cursor: pointer; font: inherit; line-height: 1.1;
		}
		#btn-panel[aria-expanded="true"]{ border-color: rgba(255,255,255,.65) }

		/* 2. –í—ã–µ–∑–∂–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (3 —Å—Ç—Ä–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏) */
		#panel{
			position: fixed;
			left: 0; right: 0; bottom: 0;
			height: var(--panel-h);
			background: rgba(10,14,19,.98);
			border-top: 1px solid rgba(255,255,255,.08);
			box-shadow: 0 -10px 30px rgba(0,0,0,.35);
			transform: translateY(100%);
			transition: transform .25s ease;
			display: grid;
			grid-template-rows: auto 1fr;
			z-index: 50;
		}
		#panel.open{ transform: translateY(0%) }

		/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ */
		#panel-head{
			display:flex; align-items:center; gap:10px;
			padding: 10px var(--pad);
			border-bottom: 1px solid rgba(255,255,255,.08);
		}
		#panel-title{ font-weight:600 }
		#btn-close{
			margin-left:auto;
			background: transparent; color: var(--text);
			border: 1px solid rgba(255,255,255,.18);
			border-radius: var(--radius); padding: 6px 10px; cursor: pointer; font: inherit;
		}

		/* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏: —Ç—Ä–∏ —Ä—è–¥–∞ (1: –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã, 2: –∏—Å—Ç–æ—á–Ω–∏–∫–∏, 3: –∏–∑–±—Ä–∞–Ω–Ω–æ–µ/—Å—Å—ã–ª–∫–∏) */
		#panel-body{
			display: grid;
			grid-template-rows: repeat(3, 1fr);
			padding: var(--pad);
			gap: 8px;
		}
		.row{display:flex;align-items:center;gap:10px;min-height:0}
		.row a,.row button{
			background: transparent; color: var(--text);
			border: 1px solid rgba(255,255,255,.18);
			border-radius: var(--radius); padding: 6px 10px;
			cursor: pointer; text-decoration: none; font: inherit; line-height: 1.1; white-space: nowrap;
		}
		.row a:hover,.row button:hover{border-color: rgba(255,255,255,.35)}
		.row .muted{color: var(--muted);border-color: rgba(255,255,255,.12)}
		.row .danger{color: var(--danger);border-color: rgba(255,0,0,.25)}
		.row .star.active{background: rgba(255,214,92,.08);border-color: rgba(255,214,92,.8);color: var(--accent)}
		.row .active{border-color: rgba(255,255,255,.65)}
		#last-upd{ color: var(--muted); margin-left: auto }

		.hint{padding:8px 14px;color:var(--muted);font-size:12px}
		.err{color:var(--danger)}
	</style>

	<!-- –í–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã (—Ñ–∞–∫—Ç): Telegram WebApp, Lightweight-Charts; TradingView –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é -->
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
	<!-- –ù–∞—à –º–æ–¥—É–ª—å (—Ñ–∞–∫—Ç) -->
	<script defer src="./js/okx_chart.js"></script>
</head>
<body>
<div id="wrap">
	<header id="title">Chart</header>
	<div id="chart"></div>

	<!-- –£–∑–∫–∞—è –¥–æ–∫-–ø–∞–Ω–µ–ª—å: —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å + —Å—Ç—Ä–µ–ª–∫–∞ (—Ñ–∞–∫—Ç) -->
	<footer id="dock" aria-label="status bar">
		<div id="status-dot" class="offline" aria-hidden="true"></div>
		<span id="status-text">–û—Ñ—Ñ–ª–∞–π–Ω</span>
		<div class="spacer"></div>
		<button id="btn-panel" aria-expanded="false" aria-controls="panel" title="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏">‚ñ≤</button>
	</footer>

	<!-- –í—ã–µ–∑–∂–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ ‚Äî 3 —Å—Ç—Ä–æ–∫–∏ (—Ñ–∞–∫—Ç) -->
	<section id="panel" role="dialog" aria-modal="true" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞" hidden>
		<div id="panel-head">
			<div id="panel-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
			<button id="btn-close" type="button" title="–ó–∞–∫—Ä—ã—Ç—å">–ó–∞–∫—Ä—ã—Ç—å</button>
		</div>
		<div id="panel-body">
			<!-- 1 –°–¢–†–û–ö–ê: –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã/–¢–§ -->
			<div class="row" id="row-intervals">
				<span class="muted">–¢–∞–π–º—Ñ—Ä–µ–π–º:</span>
				<a data-int="15"  class="int">15m</a>
				<a data-int="60"  class="int">1h</a>
				<a data-int="240" class="int">4h</a>
				<a data-int="1440" class="int">1d</a>
				<span id="last-upd" title="–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ">‚Ä¶</span>
			</div>

			<!-- 2 –°–¢–†–û–ö–ê: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–≥–ª–∞–≤–Ω—ã–π OKX) -->
			<div class="row" id="row-sources">
				<span class="muted">–ò—Å—Ç–æ—á–Ω–∏–∫:</span>
				<button type="button" class="src" data-src="okx">OKX (API/WS)</button>
				<button type="button" class="src" data-src="tv">TradingView (–≤–∏–¥–∂–µ—Ç)</button>
				<span id="sym" class="muted" style="margin-left:auto"></span>
			</div>

			<!-- 3 –°–¢–†–û–ö–ê: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ + –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ + –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -->
			<div class="row" id="row-actions">
				<button id="btn-fav" class="star" type="button" aria-pressed="false">‚≠êÔ∏è –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
				<a id="okx-link" class="danger"   target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ OKX</a>
				<a id="tv-link"  class="muted"    target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –≤ TradingView</a>
				<button id="btn-copy" class="muted" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
			</div>
		</div>
	</section>

	<div class="hint" id="hint"></div>
</div>

<script>
/* ---------------------------
 * –õ–û–ì–ò–ö–ê –î–û–ö–ê –ò –ü–ê–ù–ï–õ–ò (—Ñ–∞–∫—Ç)
 * --------------------------- */
(function(){
	const btn = document.getElementById('btn-panel');
	const panel = document.getElementById('panel');
	const close = document.getElementById('btn-close');

	function openPanel(){
		panel.hidden = false;
		requestAnimationFrame(()=> panel.classList.add('open'));
		btn.setAttribute('aria-expanded', 'true');
	}
	function closePanel(){
		panel.classList.remove('open');
		btn.setAttribute('aria-expanded', 'false');
		setTimeout(()=>{ panel.hidden = true; }, 250);
	}
	btn.addEventListener('click', ()=>{
		const expanded = btn.getAttribute('aria-expanded') === 'true';
		if (expanded) closePanel(); else openPanel();
	});
	close.addEventListener('click', closePanel);

	// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —Å–≤–∞–π–ø—É –≤–Ω–∏–∑ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
	let startY=0;
	panel.addEventListener('touchstart', (e)=>{ startY = e.touches[0].clientY; }, {passive:true});
	panel.addEventListener('touchmove', (e)=>{
		const dy = e.touches[0].clientY - startY;
		if (dy>60) closePanel();
	},{passive:true});
})();
</script>
</body>
</html>
