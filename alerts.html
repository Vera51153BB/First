<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</title>
  <!-- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è CSP –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ GH Pages -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://telegram.org https://*.telegram.org; connect-src 'none'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; frame-ancestors https://web.telegram.org https://*.telegram.org;" />
  <style>
    :root {
      --bg: #050029;
      --text: #e6ddcd;
      --muted: #cfc5b3;
      --on: #79c172;
      --off: #ff5f5f;
      --knob: #2b3140;
      --card: #0b0736;
      --shadow: 0 10px 24px rgba(0,0,0,.35);
      --radius: 18px;
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }
    .wrap { max-width: 860px; margin: 0 auto; padding: 20px 16px 28px; }
    .title {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin-bottom: 14px;
    }
    h1 { margin: 0; font-size: 34px; letter-spacing: .5px; }
    .subtitle { color: var(--muted); font-size: 18px; margin: 0 0 18px; }

    /* Action bar */
    .actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      appearance: none; border: 0; border-radius: 999px; padding: 12px 18px;
      font-weight: 600; cursor: pointer; box-shadow: var(--shadow);
      transition: transform .06s ease, opacity .2s ease;
      white-space: nowrap;
    }
    .btn:active { transform: translateY(1px) scale(.98); }
    .btn-save { background: var(--on); color: #0b1a10; }
    .btn-save span.icon { margin-right: 8px; }

    /* Card */
    .card { background: var(--card); border-radius: var(--radius); padding: 18px 16px; box-shadow: var(--shadow); }
    .section { margin-top: 18px; }

    /* Grid rows */
    .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; padding: 14px 12px; }
    .row + .row { border-top: 1px solid rgba(255,255,255,.06); }
    .label { font-size: 18px; }
    .state { font-size: 14px; color: var(--muted); }

    /* Switch */
    .switch { width: 140px; height: 44px; position: relative; border-radius: 999px; display: grid; grid-template-columns: 1fr 1fr; overflow: hidden; box-shadow: inset 0 0 0 1px rgba(0,0,0,.2); }
    .switch[data-on="true"] { background: linear-gradient(90deg, var(--on) 0 50%, var(--off) 50% 100%); }
    .switch[data-on="false"]{ background: linear-gradient(90deg, var(--on) 0 50%, var(--off) 50% 100%); filter: saturate(.9); }
    .switch .side { display:flex; align-items:center; justify-content:center; font-weight:700; color:#0a1110; }
    .switch .side.off { color:#3a0e0e; }
    .knob { position:absolute; top:4px; width:64px; height:36px; border-radius:999px; background:var(--knob); box-shadow: 0 4px 10px rgba(0,0,0,.35);
            transition: left .2s ease; }
    .switch[data-on="true"]  .knob { left: 72px; }
    .switch[data-on="false"] .knob { left: 4px; }
    .switch[aria-disabled="true"] { opacity:.6; pointer-events:none; }

    /* Master dual buttons */
    .dual {
      display:flex; gap:12px; flex-wrap: wrap; margin: 10px 0 0;
    }
    .dual .pill { flex:1 1 180px; border-radius: 999px; padding: 14px 18px; text-align:center; font-weight:700; cursor:pointer; user-select:none; box-shadow: var(--shadow); }
    .pill.on  { background: var(--on);  color: #0b1a10; }
    .pill.off { background: var(--off); color: #3a0e0e; }

    .hint { color: var(--muted); font-size: 14px; margin-top: 10px; }

    .footer { margin-top: 24px; color: var(--muted); font-size: 13px; text-align:center; opacity:.8; }
    .preview { background:#1a104f; border-radius: 10px; padding: 10px 12px; margin-bottom: 12px; color:#cfd1ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <div>
        <h1>–£–í–ï–î–û–ú–õ–ï–ù–ò–Ø</h1>
        <p class="subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏. –ö–Ω–æ–ø–∫–∞ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏¬ª –æ—Ç–ø—Ä–∞–≤–∏—Ç –∏—Ö –±–æ—Ç—É —á–µ—Ä–µ–∑ Telegram WebApp.</p>
      </div>
      <div class="actions">
        <button class="btn btn-save" id="btnSave"><span class="icon">üíæ</span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
    </div>

    <div id="previewWarn" class="preview" hidden>
      –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤–Ω–µ Telegram. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ <em>localStorage</em> (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞).
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="label">–≤—Å–µ</div>
          <div class="state" id="allState">‚Äî</div>
        </div>
        <div class="dual">
          <div class="pill on"  id="btnAllOn">–≤–∫–ª—é—á–∏—Ç—å</div>
          <div class="pill off" id="btnAllOff">–≤—ã–∫–ª—é—á–∏—Ç—å</div>
        </div>
      </div>
    </div>

    <div class="section card" id="list">
      <!-- –≠–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–Ω–æ
      <div class="row">
        <div>
          <div class="label">–ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç</div>
          <div class="state">–≤–∫–ª—é—á–µ–Ω–æ</div>
        </div>
        <div class="switch" data-id="balance" data-on="true" role="switch" aria-checked="true" tabindex="0">
          <div class="side on">–í–ö–õ</div>
          <div class="side off">–í–´–ö</div>
          <div class="knob"></div>
        </div>
      </div>
      -->
    </div>

    <div class="footer">–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: –≥–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π —Ñ–æ–Ω, –±–µ–∂–µ–≤—ã–π —Ç–µ–∫—Å—Ç. –í—ë—Ä—Å—Ç–∫–∞ –≥–∏–±–∫–∞—è, –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —à–∏—Ä–∏–Ω—É.</div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω—è—Ç—å)
    const ALERTS = [
      { id: 'balance', name: '–ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç' },
      { id: 'alert2',  name: '—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 2' },
      { id: 'alert3',  name: '—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 3' },
      { id: 'alert4',  name: '—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 4' },
    ];

    // –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî —Å–µ—Ä–≤–µ—Ä. –ù–æ –¥–ª—è UX ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à
    const LS_KEY = 'okx_alerts';

    function loadLocal() {
      try { return JSON.parse(localStorage.getItem(LS_KEY) || '{}'); } catch { return {}; }
    }
    function saveLocal(obj) {
      try { localStorage.setItem(LS_KEY, JSON.stringify(obj)); } catch {}
    }

    function createRow(alert, on) {
      const row = document.createElement('div');
      row.className = 'row';

      const left = document.createElement('div');
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = alert.name;
      const state = document.createElement('div');
      state.className = 'state';
      state.textContent = on ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ';
      left.append(label, state);

      const sw = document.createElement('div');
      sw.className = 'switch';
      sw.setAttribute('role', 'switch');
      sw.dataset.id = alert.id;
      setSwitch(sw, on);

      sw.innerHTML = `<div class="side on">–í–ö–õ</div><div class="side off">–í–´–ö</div><div class="knob"></div>`;

      const toggle = () => {
        const cur = sw.dataset.on === 'true';
        setSwitch(sw, !cur);
        state.textContent = !cur ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ';
        updateAllState();
      };

      sw.addEventListener('click', toggle);
      sw.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); toggle(); }
      });

      row.append(left, sw);
      return row;
    }

    function setSwitch(el, on) {
      el.dataset.on = String(on);
      el.setAttribute('aria-checked', String(on));
    }

    function currentModel() {
      const map = {};
      document.querySelectorAll('.switch[data-id]').forEach(sw => {
        map[sw.dataset.id] = (sw.dataset.on === 'true');
      });
      return { alerts: Object.entries(map).map(([id, on]) => ({ id, on })) };
    }

    function setAll(on) {
      document.querySelectorAll('.switch[data-id]').forEach(sw => setSwitch(sw, on));
      document.querySelectorAll('.row .state').forEach((el, idx) => {
        if (idx === 0) return; // –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
        el.textContent = on ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ';
      });
      updateAllState();
    }

    function updateAllState() {
      const model = currentModel();
      const total = model.alerts.length;
      const onCount = model.alerts.filter(a => a.on).length;
      const txt = onCount === 0 ? '–≤—Å—ë –≤—ã–∫–ª—é—á–µ–Ω–æ' : onCount === total ? '–≤—Å—ë –≤–∫–ª—é—á–µ–Ω–æ' : `${onCount} –∏–∑ ${total} –≤–∫–ª—é—á–µ–Ω–æ`;
      document.getElementById('allState').textContent = txt;
    }

    function render() {
      const list = document.getElementById('list');
      const saved = loadLocal();
      list.innerHTML = '';
      ALERTS.forEach(a => {
        const on = saved[a.id] ?? (a.id === 'balance'); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á—ë–Ω —Ç–æ–ª—å–∫–æ ¬´–ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç¬ª
        const row = createRow(a, !!on);
        list.appendChild(row);
      });
      updateAllState();
    }

    function isTelegram() {
      return !!(tg && tg.initDataUnsafe && (tg.initDataUnsafe.user || tg.initData));
    }

    function sendToBot(model) {
      const payload = JSON.stringify(model);
      if (isTelegram()) {
        tg.HapticFeedback?.impactOccurred?.('light');
        tg.sendData(payload); // Telegram –¥–æ—Å—Ç–∞–≤–∏—Ç —ç—Ç–æ –±–æ—Ç—É –∫–∞–∫ web_app_data
        // UI-—Ñ–∏–¥–±–µ–∫
        tg.showAlert?.('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É');
      } else {
        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        const flat = Object.fromEntries(model.alerts.map(a => [a.id, a.on]));
        saveLocal(flat);
        document.getElementById('previewWarn').innerHTML = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ <em>localStorage</em> (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä).';
        document.getElementById('previewWarn').hidden = false;
      }
    }

    // bootstrap
    render();

    // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    document.getElementById('btnAllOn').addEventListener('click', () => setAll(true));
    document.getElementById('btnAllOff').addEventListener('click', () => setAll(false));
    document.getElementById('btnSave').addEventListener('click', () => sendToBot(currentModel()));

    // Telegram —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
    if (isTelegram()) {
      tg.expand?.();
      tg.setHeaderColor?.('#050029');
      tg.setBackgroundColor?.('#050029');
    } else {
      document.getElementById('previewWarn').hidden = false;
    }
  </script>
</body>
</html>
