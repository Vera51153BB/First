<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OKX Swap — Embed</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    /* Страница только с импортом внешней страницы OKX.
       IFRAME растягивается на всю высоту окна, прокрутки у документа нет. */
    :root{
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    html,body{
      height:100%;
      margin:0;
      background:#0b0e14;
      color:#e5e7eb;
      overflow:hidden;              /* без прокрутки вокруг iframe */
      font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    #wrap{
      height:100vh;
      height:100svh;                /* корректно на мобильных */
      padding: 0 0 var(--safe-bottom) 0;
      display:flex;
      flex-direction:column;
    }
    iframe{
      border:0;
      width:100%;
      height:100%;
      display:block;
      background:#0b0e14;
    }
    /* Небольшая ненавязчивая плашка-фолбек (если вдруг нужно показать ссылку) */
    .fallback{
      position:fixed; left:0; right:0; bottom:0;
      padding:8px 12px calc(8px + var(--safe-bottom));
      background:linear-gradient(0deg,rgba(15,19,25,.96),rgba(15,19,25,.86));
      color:#93a3b8; font-size:12px;
      text-align:center;
      border-top:1px solid rgba(255,255,255,.08);
      display:none;                 /* по умолчанию скрыто: страница — только импорт */
    }
    .fallback a{ color:#cfe1ff; text-decoration:none; font-weight:700 }
  </style>
</head>
<body>
  <div id="wrap">
    <iframe id="okxFrame" title="OKX Swap"></iframe>
  </div>

  <!-- Telegram WebApp SDK (без зависимости; просто на случай открытия в боте) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // ---------- Помощники ----------
    function getParam(name){
      const u = new URL(location.href);
      return u.searchParams.get(name) || '';
    }
    // Нормализуем символ в slug OKX вида: <base>-usdt-swap
    // Принимаем: 'ETH-USDT-SWAP', 'eth-usdt', 'ETH', 'sol', 'btc/usdt', 'btc_usdt_swap' и т.п.
    function toOkxSwapSlug(symbol){
      if (!symbol) return 'eth-usdt-swap';
      let s = String(symbol).trim().toLowerCase();

      // убираем пробелы, заменяем / и _ на дефис
      s = s.replace(/\s+/g,'').replace(/[\/_]/g,'-').replace(/-+/g,'-');

      if (s.endsWith('-swap')) return s;         // уже полноформатный slug
      if (/-usdt$/.test(s)) return s + '-swap';  // есть пара, добавим -swap
      // только тикер → считаем usdt perp
      if (/^[a-z0-9]+$/.test(s)) return s + '-usdt-swap';

      // иначе добьем безопасно
      if (!/-usdt(-|$)/.test(s)) s = s.replace(/-swap$/, '') + '-usdt';
      if (!s.endsWith('-swap')) s += '-swap';
      return s;
    }

    // ---------- Основная логика ----------
    (function init(){
      // По умолчанию ETH
      let symbol = getParam('symbol') || getParam('ticker') || getParam('coin') || 'ETH-USDT-SWAP';
      const slug  = toOkxSwapSlug(symbol);
      const url   = `https://www.okx.com/ru/markets/swap-info/${slug}`;

      // Если страница открыта в Telegram WebApp — можно слегка подстроить цветовую тему
      if (window.Telegram && window.Telegram.WebApp){
        try{
          Telegram.WebApp.ready();
          Telegram.WebApp.setBackgroundColor('#0b0e14');
          Telegram.WebApp.setHeaderColor('secondary_bg_color');
        }catch(e){}
      }

      // Вставляем в iframe
      document.getElementById('okxFrame').src = url;

      // Если нужно включить плашку-фолбек со ссылкой (например, если сайт запрещает iframes),
      // просто раскомментируйте строки ниже:
      // const fb = document.createElement('div');
      // fb.className = 'fallback';
      // fb.innerHTML = `Если виджет не загрузился, откройте напрямую: <a href="${url}" target="_blank" rel="noopener">OKX — ${slug}</a>`;
      // document.body.appendChild(fb);
      // fb.style.display = 'block';
    })();
  </script>
</body>
</html>
